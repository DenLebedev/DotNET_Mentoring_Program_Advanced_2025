Î
eD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Swagger\SwaggerDefaultValues.cs
public 
class  
SwaggerDefaultValues !
:" #
IOperationFilter$ 4
{ 
public 

void 
Apply 
( 
OpenApiOperation &
	operation' 0
,0 1"
OperationFilterContext2 H
contextI P
)P Q
{ 
var		 
apiDescription		 
=		 
context		 $
.		$ %
ApiDescription		% 3
;		3 4
if 

( 
	operation 
. 

Parameters  
==! #
null$ (
)( )
{ 	
return 
; 
} 	
foreach 
( 
var 
	parameter 
in !
	operation" +
.+ ,

Parameters, 6
.6 7
OfType7 =
<= >
OpenApiParameter> N
>N O
(O P
)P Q
)Q R
{ 	
var 
description 
= 
apiDescription ,
., -!
ParameterDescriptions- B
. 
FirstOrDefault 
(  
p  !
=>" $
p% &
.& '
Name' +
==, .
	parameter/ 8
.8 9
Name9 =
)= >
;> ?
if 
( 
description 
== 
null #
)# $
continue 
; 
if 
( 
description 
. 
Source "
?" #
.# $
Id$ &
==' )
$str* 6
)6 7
{ 
	parameter 
. 
Description %
??=& )
$str* E
;E F
continue 
; 
} 
	parameter 
. 
Description !
??=" %
description& 1
.1 2
ModelMetadata2 ?
?? @
.@ A
DescriptionA L
;L M
	parameter 
. 
Required 
|= !
description" -
.- .

IsRequired. 8
;8 9
}   	
}!! 
}"" Ñ
hD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Swagger\ConfigureSwaggerOptions.cs
public 
class #
ConfigureSwaggerOptions $
:% &
IConfigureOptions' 8
<8 9
SwaggerGenOptions9 J
>J K
{ 
private 
readonly *
IApiVersionDescriptionProvider 3
	_provider4 =
;= >
public

 
#
ConfigureSwaggerOptions

 "
(

" #*
IApiVersionDescriptionProvider

# A
provider

B J
)

J K
{ 
	_provider 
= 
provider 
; 
} 
public 

void 
	Configure 
( 
SwaggerGenOptions +
options, 3
)3 4
{ 
foreach 
( 
var 
desc 
in 
	_provider &
.& '"
ApiVersionDescriptions' =
)= >
{ 	
options 
. 

SwaggerDoc 
( 
desc #
.# $
	GroupName$ -
,- .
new/ 2
OpenApiInfo3 >
{ 
Title 
= 
$" 
$str .
{. /
desc/ 3
.3 4

ApiVersion4 >
}> ?
"? @
,@ A
Version 
= 
desc 
. 

ApiVersion )
.) *
ToString* 2
(2 3
)3 4
} 
) 
; 
} 	
} 
} ïe
PD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddAutoMapper 
( 
typeof %
(% &
MappingProfile& 4
)4 5
)5 6
;6 7
builder 
. 
Services 
. 
	AddScoped 
< 
IUnitOfWork &
>& '
(' (
sp( *
=>+ -
new. 1
LiteDBUnitOfWork2 B
(B C
$strC q
)q r
)r s
;s t
builder 
. 
Services 
. 
	AddScoped 
< 
ICartBL "
," #
CartBL$ *
>* +
(+ ,
), -
;- .
builder 
. 
Services 
.  
AddDefaultAWSOptions %
(% &
builder& -
.- .
Configuration. ;
.; <
GetAWSOptions< I
(I J
)J K
)K L
;L M
builder 
. 
Services 
. 
AddAWSService 
< 

IAmazonSQS )
>) *
(* +
)+ ,
;, -
builder 
. 
Services 
. 
AddHostedService !
<! "%
CatalogItemUpdateListener" ;
>; <
(< =
)= >
;> ?
builder 
. 
Services 
. 
AddApiVersioning !
(! "
options" )
=>* ,
{ 
options   
.   
ReportApiVersions   
=   
true    $
;  $ %
options!! 
.!! /
#AssumeDefaultVersionWhenUnspecified!! /
=!!0 1
true!!2 6
;!!6 7
options"" 
."" 
DefaultApiVersion"" 
="" 
new""  #

ApiVersion""$ .
("". /
$num""/ 0
,""0 1
$num""2 3
)""3 4
;""4 5
}## 
)## 
;## 
builder&& 
.&& 
Services&& 
.&& #
AddVersionedApiExplorer&& (
(&&( )
options&&) 0
=>&&1 3
{'' 
options(( 
.(( 
GroupNameFormat(( 
=(( 
$str(( &
;((& '
options)) 
.)) %
SubstituteApiVersionInUrl)) %
=))& '
true))( ,
;)), -
}** 
)** 
;** 
builder-- 
.-- 
Services-- 
.-- 
AddSwaggerGen-- 
(-- 
options-- &
=>--' )
{.. 
options// 
.// !
DocInclusionPredicate// !
(//! "
(//" #
docName//# *
,//* +
apiDesc//, 3
)//3 4
=>//5 7
{00 
var11 
	groupName11 
=11 
apiDesc11 
.11  
	GroupName11  )
;11) *
return22 
!22 
string22 
.22 
IsNullOrEmpty22 $
(22$ %
	groupName22% .
)22. /
&&220 2
	groupName223 <
==22= ?
docName22@ G
;22G H
}33 
)33 
;33 
options55 
.55 
OperationFilter55 
<55  
SwaggerDefaultValues55 0
>550 1
(551 2
)552 3
;553 4
options66 
.66 %
ResolveConflictingActions66 %
(66% &
apiDescriptions66& 5
=>666 8
apiDescriptions669 H
.66H I
First66I N
(66N O
)66O P
)66P Q
;66Q R
options88 
.88 !
AddSecurityDefinition88 !
(88! "
$str88" *
,88* +
new88, /
	Microsoft880 9
.889 :
OpenApi88: A
.88A B
Models88B H
.88H I!
OpenApiSecurityScheme88I ^
{99 
Type:: 
=:: 
	Microsoft:: 
.:: 
OpenApi::  
.::  !
Models::! '
.::' (
SecuritySchemeType::( :
.::: ;
OAuth2::; A
,::A B
Flows;; 
=;; 
new;; 
	Microsoft;; 
.;; 
OpenApi;; %
.;;% &
Models;;& ,
.;;, -
OpenApiOAuthFlows;;- >
{<< 	
Password== 
=== 
new== 
	Microsoft== $
.==$ %
OpenApi==% ,
.==, -
Models==- 3
.==3 4
OpenApiOAuthFlow==4 D
{>> 
TokenUrl?? 
=?? 
new?? 
Uri?? "
(??" #
$str??# I
)??I J
,??J K
Scopes@@ 
=@@ 
new@@ 

Dictionary@@ '
<@@' (
string@@( .
,@@. /
string@@0 6
>@@6 7
{AA 
{BB 
$strBB #
,BB# $
$strBB% <
}BB= >
,BB> ?
{CC 
$strCC 
,CC 
$strCC  0
}CC1 2
,CC2 3
{DD 
$strDD 
,DD  
$strDD! /
}DD0 1
,DD1 2
{EE 
$strEE &
,EE& '
$strEE( 7
}EE8 9
}FF 
}GG 
}HH 	
}II 
)II 
;II 
optionsKK 
.KK "
AddSecurityRequirementKK "
(KK" #
newKK# &
	MicrosoftKK' 0
.KK0 1
OpenApiKK1 8
.KK8 9
ModelsKK9 ?
.KK? @&
OpenApiSecurityRequirementKK@ Z
{LL 
{MM 	
newNN 
	MicrosoftNN 
.NN 
OpenApiNN !
.NN! "
ModelsNN" (
.NN( )!
OpenApiSecuritySchemeNN) >
{OO 
	ReferencePP 
=PP 
newPP 
	MicrosoftPP  )
.PP) *
OpenApiPP* 1
.PP1 2
ModelsPP2 8
.PP8 9
OpenApiReferencePP9 I
{QQ 
TypeRR 
=RR 
	MicrosoftRR $
.RR$ %
OpenApiRR% ,
.RR, -
ModelsRR- 3
.RR3 4
ReferenceTypeRR4 A
.RRA B
SecuritySchemeRRB P
,RRP Q
IdSS 
=SS 
$strSS !
}TT 
}UU 
,UU 
newVV 
[VV 
]VV 
{VV 
$strVV !
}VV" #
}WW 	
}XX 
)XX 
;XX 
}YY 
)YY 
;YY 
builder\\ 
.\\ 
Services\\ 
.\\ 
ConfigureOptions\\ !
<\\! "#
ConfigureSwaggerOptions\\" 9
>\\9 :
(\\: ;
)\\; <
;\\< =
builder__ 
.__ 
Services__ 
.__ 
AddAuthentication__ "
(__" #
$str__# +
)__+ ,
.`` 
AddJwtBearer`` 
(`` 
$str`` 
,`` 
options`` #
=>``$ &
{aa 
optionsbb 
.bb 
	Authoritybb 
=bb 
$strbb 4
;bb4 5
optionscc 
.cc  
RequireHttpsMetadatacc $
=cc% &
falsecc' ,
;cc, -
optionsdd 
.dd %
TokenValidationParametersdd )
=dd* +
newdd, /%
TokenValidationParametersdd0 I
{ee 	
ValidateAudienceff 
=ff 
falseff $
}gg 	
;gg	 

}hh 
)hh 
;hh 
builderjj 
.jj 
Servicesjj 
.jj 
AddAuthorizationjj !
(jj! "
optionsjj" )
=>jj* ,
{kk 
optionsll 
.ll 
	AddPolicyll 
(ll 
$strll )
,ll) *
policyll+ 1
=>ll2 4
policymm 
.mm 
RequireRolemm 
(mm 
$strmm $
,mm$ %
$strmm& 5
)mm5 6
)mm6 7
;mm7 8
}nn 
)nn 
;nn 
varpp 
apppp 
=pp 	
builderpp
 
.pp 
Buildpp 
(pp 
)pp 
;pp 
varss 
providerss 
=ss 
appss 
.ss 
Servicesss 
.ss 
GetRequiredServicess .
<ss. /
	Microsoftss/ 8
.ss8 9

AspNetCoress9 C
.ssC D
MvcssD G
.ssG H
ApiExplorerssH S
.ssS T*
IApiVersionDescriptionProviderssT r
>ssr s
(sss t
)sst u
;ssu v
ifvv 
(vv 
appvv 
.vv 
Environmentvv 
.vv 
IsDevelopmentvv !
(vv! "
)vv" #
)vv# $
{ww 
appxx 
.xx 

UseSwaggerxx 
(xx 
)xx 
;xx 
appzz 
.zz 
UseSwaggerUIzz 
(zz 
optionszz 
=>zz 
{{{ 
foreach|| 
(|| 
var|| 
desc|| 
in|| 
provider|| %
.||% &"
ApiVersionDescriptions||& <
)||< =
{}} 	
options~~ 
.~~ 
SwaggerEndpoint~~ #
(~~# $
$" 
$str 
{ 
desc  
.  !
	GroupName! *
}* +
$str+ 8
"8 9
,9 :
$"
ÄÄ 
$str
ÄÄ %
{
ÄÄ% &
desc
ÄÄ& *
.
ÄÄ* +
	GroupName
ÄÄ+ 4
.
ÄÄ4 5
ToUpperInvariant
ÄÄ5 E
(
ÄÄE F
)
ÄÄF G
}
ÄÄG H
"
ÄÄH I
)
ÄÄI J
;
ÄÄJ K
}
ÅÅ 	
options
ÉÉ 
.
ÉÉ 
OAuthClientId
ÉÉ 
(
ÉÉ 
$str
ÉÉ *
)
ÉÉ* +
;
ÉÉ+ ,
options
ÑÑ 
.
ÑÑ 
OAuthClientSecret
ÑÑ !
(
ÑÑ! "
$str
ÑÑ" 2
)
ÑÑ2 3
;
ÑÑ3 4
options
ÖÖ 
.
ÖÖ 
OAuthAppName
ÖÖ 
(
ÖÖ 
$str
ÖÖ 8
)
ÖÖ8 9
;
ÖÖ9 :
options
ÜÜ 
.
ÜÜ 
OAuthUsePkce
ÜÜ 
(
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
áá 
)
áá 
;
áá 
app
ââ 
.
ââ '
UseDeveloperExceptionPage
ââ !
(
ââ! "
)
ââ" #
;
ââ# $
}ää 
appåå 
.
åå !
UseHttpsRedirection
åå 
(
åå 
)
åå 
;
åå 
appçç 
.
çç 
Use
çç 
(
çç 
async
çç 
(
çç 
context
çç 
,
çç 
next
çç 
)
çç 
=>
çç  
{éé 
if
èè 
(
èè 
context
èè 
.
èè 
Request
èè 
.
èè 
Path
èè 
.
èè  
StartsWithSegments
èè /
(
èè/ 0
$str
èè0 :
)
èè: ;
)
èè; <
await
èè= B
next
èèC G
(
èèG H
)
èèH I
;
èèI J
else
êê 
await
êê	 
next
êê 
(
êê 
)
êê 
;
êê 
}ëë 
)
ëë 
;
ëë 
appíí 
.
íí 
UseAuthentication
íí 
(
íí 
)
íí 
;
íí 
appìì 
.
ìì 
UseMiddleware
ìì 
<
ìì 
CartingService
ìì  
.
ìì  !

Middleware
ìì! +
.
ìì+ ,$
TokenLoggingMiddleware
ìì, B
>
ììB C
(
ììC D
)
ììD E
;
ììE F
appîî 
.
îî 
UseAuthorization
îî 
(
îî 
)
îî 
;
îî 
appïï 
.
ïï 
MapControllers
ïï 
(
ïï 
)
ïï 
;
ïï 
appóó 
.
óó 
Run
óó 
(
óó 
)
óó 	
;
óó	 

publicôô 
partial
ôô 
class
ôô 
Program
ôô 
{
ôô 
}
ôô  ¯
jD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Middleware\TokenLoggingMiddleware.cs
	namespace 	
CartingService
 
. 

Middleware #
{ 
public 

class "
TokenLoggingMiddleware '
{ 
private		 
readonly		 
RequestDelegate		 (
_next		) .
;		. /
public "
TokenLoggingMiddleware %
(% &
RequestDelegate& 5
next6 :
): ;
{ 	
_next 
= 
next 
; 
} 	
public 
async 
Task 
Invoke  
(  !
HttpContext! ,
context- 4
)4 5
{ 	
var 
token 
= 
context 
.  
Request  '
.' (
Headers( /
[/ 0
$str0 ?
]? @
.@ A
FirstOrDefaultA O
(O P
)P Q
?Q R
.R S
ReplaceS Z
(Z [
$str[ d
,d e
$strf h
)h i
;i j
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
token& +
)+ ,
), -
{ 
var 

jwtHandler 
=  
new! $#
JwtSecurityTokenHandler% <
(< =
)= >
;> ?
if 
( 

jwtHandler 
. 
CanReadToken +
(+ ,
token, 1
)1 2
)2 3
{ 
var 
jwtToken  
=! "

jwtHandler# -
.- .
ReadJwtToken. :
(: ;
token; @
)@ A
;A B
var 
subject 
=  !
jwtToken" *
.* +
Subject+ 2
;2 3
var 
roles 
= 
jwtToken  (
.( )
Claims) /
./ 0
Where0 5
(5 6
c6 7
=>8 :
c; <
.< =
Type= A
==B D
$strE K
)K L
.L M
SelectM S
(S T
cT U
=>V X
cY Z
.Z [
Value[ `
)` a
;a b
var 
permissions #
=$ %
jwtToken& .
.. /
Claims/ 5
.5 6
Where6 ;
(; <
c< =
=>> @
cA B
.B C
TypeC G
==H J
$strK W
)W X
.X Y
SelectY _
(_ `
c` a
=>b d
ce f
.f g
Valueg l
)l m
;m n
Console 
. 
	WriteLine %
(% &
$"& (
$str( 9
{9 :
subject: A
}A B
"B C
)C D
;D E
Console   
.   
	WriteLine   %
(  % &
$"  & (
$str  ( 7
{  7 8
string  8 >
.  > ?
Join  ? C
(  C D
$str  D H
,  H I
roles  J O
)  O P
}  P Q
"  Q R
)  R S
;  S T
Console!! 
.!! 
	WriteLine!! %
(!!% &
$"!!& (
$str!!( =
{!!= >
string!!> D
.!!D E
Join!!E I
(!!I J
$str!!J N
,!!N O
permissions!!P [
)!![ \
}!!\ ]
"!!] ^
)!!^ _
;!!_ `
}"" 
}## 
await%% 
_next%% 
(%% 
context%% 
)%%  
;%%  !
}&& 	
}'' 
}(( ˝
`D:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Mappings\MappingProfile.cs
	namespace 	
CartingService
 
. 
Mappings !
{ 
public 

class 
MappingProfile 
:  !
Profile" )
{ 
public		 
MappingProfile		 
(		 
)		 
{

 	
	CreateMap 
< 
Item 
, 
ItemDto #
># $
($ %
)% &
.& '

ReverseMap' 1
(1 2
)2 3
;3 4
	CreateMap 
< 
Cart 
, 
CartDto #
># $
($ %
)% &
.& '

ReverseMap' 1
(1 2
)2 3
;3 4
} 	
} 
} ¶>
lD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Listeners\CatalogItemUpdateListener.cs
	namespace 	
CartingService
 
. 
	Listeners "
{ 
public 

class %
CatalogItemUpdateListener *
:+ ,
BackgroundService- >
{ 
private 
readonly 

IAmazonSQS #
_sqs$ (
;( )
private 
string 
	_queueUrl  
;  !
private 
readonly 
ILogger  
<  !%
CatalogItemUpdateListener! :
>: ;
_logger< C
;C D
private 
readonly  
IServiceScopeFactory -
_scopeFactory. ;
;; <
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public %
CatalogItemUpdateListener (
(( )

IAmazonSQS 
sqs 
, 
IConfiguration 
configuration (
,( )
ILogger 
< %
CatalogItemUpdateListener -
>- .
logger/ 5
,5 6 
IServiceScopeFactory  
scopeFactory! -
)- .
{ 	
_sqs 
= 
sqs 
; 
_logger 
= 
logger 
; 
_scopeFactory 
= 
scopeFactory (
;( )
_configuration 
= 
configuration *
;* +
_logger   
.   
LogInformation   "
(  " #
$str  # D
,  D E
	_queueUrl  F O
)  O P
;  P Q
}!! 	
	protected## 
override## 
async##  
Task##! %
ExecuteAsync##& 2
(##2 3
CancellationToken##3 D
stoppingToken##E R
)##R S
{$$ 	
if%% 
(%% 
string%% 
.%% 
IsNullOrWhiteSpace%% )
(%%) *
	_queueUrl%%* 3
)%%3 4
)%%4 5
{&& 
var'' 
	queueName'' 
='' 
_configuration''  .
[''. /
$str''/ P
]''P Q
;''Q R
var(( 
response(( 
=(( 
await(( $
_sqs((% )
.(() *
GetQueueUrlAsync((* :
(((: ;
	queueName((; D
)((D E
;((E F
	_queueUrl)) 
=)) 
response)) $
.))$ %
QueueUrl))% -
;))- .
_logger** 
.** 
LogInformation** &
(**& '
$str**' G
,**G H
	_queueUrl**I R
)**R S
;**S T
}++ 
while-- 
(-- 
!-- 
stoppingToken-- !
.--! "#
IsCancellationRequested--" 9
)--9 :
{.. 
var// 
request// 
=// 
new// !!
ReceiveMessageRequest//" 7
{00 
QueueUrl11 
=11 
	_queueUrl11 (
,11( )
MaxNumberOfMessages22 '
=22( )
$num22* +
,22+ ,
WaitTimeSeconds33 #
=33$ %
$num33& (
}44 
;44 
var66 
response66 
=66 
await66 $
_sqs66% )
.66) *
ReceiveMessageAsync66* =
(66= >
request66> E
,66E F
stoppingToken66G T
)66T U
;66U V
var88 
messages88 
=88 
response88 '
?88' (
.88( )
Messages88) 1
;881 2
_logger99 
.99 
LogInformation99 &
(99& '
$str99' K
,99K L
messages99M U
?99U V
.99V W
Count99W \
??99] _
$num99` a
)99a b
;99b c
if<< 
(<< 
messages<< 
==<< 
null<<  $
||<<% '
messages<<( 0
.<<0 1
Count<<1 6
==<<7 9
$num<<: ;
)<<; <
{== 
_logger>> 
.>> 
LogInformation>> *
(>>* +
$str>>+ K
)>>K L
;>>L M
continue?? 
;?? 
}@@ 
foreachBB 
(BB 
varBB 
messageBB $
inBB% '
messagesBB( 0
)BB0 1
{CC 
tryDD 
{EE 
_loggerFF 
.FF  
LogInformationFF  .
(FF. /
$strFF/ H
,FFH I
messageFFJ Q
.FFQ R
BodyFFR V
)FFV W
;FFW X
varHH 
updateHH "
=HH# $
JsonSerializerHH% 3
.HH3 4
DeserializeHH4 ?
<HH? @%
CatalogItemUpdatedMessageHH@ Y
>HHY Z
(HHZ [
messageII #
.II# $
BodyII$ (
,II( )
newJJ !
JsonSerializerOptionsJJ  5
{KK '
PropertyNameCaseInsensitiveLL  ;
=LL< =
trueLL> B
}MM 
)MM 
;MM 
ifOO 
(OO 
updateOO "
==OO# %
nullOO& *
)OO* +
{PP 
_loggerQQ #
.QQ# $

LogWarningQQ$ .
(QQ. /
$strQQ/ X
)QQX Y
;QQY Z
continueRR $
;RR$ %
}SS 
ifUU 
(UU 
stringUU "
.UU" #
IsNullOrEmptyUU# 0
(UU0 1
updateUU1 7
.UU7 8
NameUU8 <
)UU< =
||UU> @
updateUUA G
.UUG H
PriceUUH M
==UUN P
nullUUQ U
)UUU V
{VV 
_loggerWW #
.WW# $

LogWarningWW$ .
(WW. /
$str	WW/ è
,
WWè ê
updateXX  &
.XX& '
IdXX' )
,XX) *
updateXX+ 1
.XX1 2
NameXX2 6
,XX6 7
updateXX8 >
.XX> ?
PriceXX? D
)XXD E
;XXE F
continueYY $
;YY$ %
}ZZ 
using\\ 
var\\ !
scope\\" '
=\\( )
_scopeFactory\\* 7
.\\7 8
CreateScope\\8 C
(\\C D
)\\D E
;\\E F
var]] 
cartService]] '
=]]( )
scope]]* /
.]]/ 0
ServiceProvider]]0 ?
.]]? @
GetRequiredService]]@ R
<]]R S
ICartBL]]S Z
>]]Z [
(]][ \
)]]\ ]
;]]] ^
_logger__ 
.__  
LogInformation__  .
(__. /
$str__/ {
,__{ |
update`` "
.``" #
Id``# %
,``% &
update``' -
.``- .
Name``. 2
,``2 3
update``4 :
.``: ;
Price``; @
)``@ A
;``A B
awaitbb 
cartServicebb )
.bb) *%
UpdateItemInAllCartsAsyncbb* C
(bbC D
updatebbD J
.bbJ K
IdbbK M
,bbM N
updatebbO U
.bbU V
NamebbV Z
,bbZ [
updatebb\ b
.bbb c
Pricebbc h
)bbh i
;bbi j
awaitdd 
_sqsdd "
.dd" #
DeleteMessageAsyncdd# 5
(dd5 6
	_queueUrldd6 ?
,dd? @
messageddA H
.ddH I
ReceiptHandleddI V
,ddV W
stoppingTokenddX e
)dde f
;ddf g
}ee 
catchff 
(ff 
	Exceptionff $
exff% '
)ff' (
{gg 
_loggerhh 
.hh  
LogErrorhh  (
(hh( )
exhh) +
,hh+ ,
$strhh- H
)hhH I
;hhI J
}ii 
}jj 
}kk 
}ll 	
}mm 
}nn ÷
VD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Entities\Item.cs
	namespace 	
CartingService
 
. 
Entities !
{ 
public 

class 
Item 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
required 
string 
Name #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public		 
required		 
string		 
ImageURL		 '
{		( )
get		* -
;		- .
set		/ 2
;		2 3
}		4 5
public

 
required

 
string

 
ImageAltText

 +
{

, -
get

. 1
;

1 2
set

3 6
;

6 7
}

8 9
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
Quantity 
{ 
get !
;! "
set# &
;& '
}( )
public 
Item 
( 
) 
{ 	
} 	
[ 	
BsonCtor	 
] 
public 
Item 
( 
int 
id 
, 
string "
name# '
,' (
string) /
imageURL0 8
,8 9
string: @
imageAltTextA M
,M N
decimalO V
priceW \
,\ ]
int^ a
quantityb j
)j k
{ 	
Id 
= 
id 
; 
Name 
= 
name 
; 
ImageURL 
= 
imageURL 
;  
ImageAltText 
= 
imageAltText '
;' (
Price 
= 
price 
; 
Quantity 
= 
quantity 
;  
} 	
} 
}  	
VD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Entities\Cart.cs
	namespace 	
CartingService
 
. 
Entities !
{ 
public 

class 
Cart 
{ 
[ 	
BsonId	 
] 
public 
string 
Key 
{ 
get 
;  
set! $
;$ %
}& '
public		 
required		 
List		 
<		 
Item		 !
>		! "
Items		# (
{		) *
get		+ .
;		. /
set		0 3
;		3 4
}		5 6
public 
Cart 
( 
) 
{ 	
} 	
[ 	
BsonCtor	 
] 
public 
Cart 
( 
string 
key 
, 
List  $
<$ %
Item% )
>) *
items+ 0
)0 1
{ 	
Key 
= 
key 
; 
Items 
= 
items 
; 
} 	
} 
} ∑	
UD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\DTOs\ItemDto.cs
	namespace 	
CartingService
 
. 
DTOs 
{ 
public 

class 
ItemDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
ImageURL 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
ImageAltText "
{# $
get% (
;( )
set* -
;- .
}/ 0
public		 
decimal		 
Price		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public

 
int

 
Quantity

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
} 
} ⁄
gD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\DTOs\CatalogItemUpdatedMessage.cs
	namespace 	
CartingService
 
. 
DTOs 
{ 
public 

class %
CatalogItemUpdatedMessage *
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
} 
}		 ê
UD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\DTOs\CartDto.cs
	namespace 	
CartingService
 
. 
DTOs 
{ 
public 

class 
CartDto 
{ 
public 
string 
Key 
{ 
get 
;  
set! $
;$ %
}& '
public 
List 
< 
ItemDto 
> 
Items "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
new3 6
List7 ;
<; <
ItemDto< C
>C D
(D E
)E F
;F G
} 
} ∫
]D:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\DAL\LiteDBUnitOfWork.cs
	namespace 	
CartingService
 
. 
DAL 
{ 
public 

class 
LiteDBUnitOfWork !
:" #
IUnitOfWork$ /
{ 
private		 
LiteDatabase		 
database		 %
;		% &
private

 
CartDAO

 
?

 
cartDAO

  
;

  !
public 
LiteDBUnitOfWork 
(  
string  &
connectionString' 7
)7 8
{ 	
database 
= 
new 
LiteDatabase '
(' (
connectionString( 8
)8 9
;9 :
} 	
public 
ILiteCollection 
< 
Cart #
># $
GetCartCollection% 6
(6 7
)7 8
{ 	
return 
database 
. 
GetCollection )
<) *
Cart* .
>. /
(/ 0
$str0 7
)7 8
;8 9
} 	
public 
ICartDAO 
Cart 
{ 	
get 
{ 
if 
( 
cartDAO 
== 
null #
)# $
{ 
cartDAO   
=   
new   !
CartDAO  " )
(  ) *
this  * .
)  . /
;  / 0
}!! 
return"" 
cartDAO"" 
;"" 
}## 
}$$ 	
private&& 
bool&& 
disposed&& 
=&& 
false&&  %
;&&% &
public(( 
virtual(( 
void(( 
Dispose(( #
(((# $
bool(($ (
	disposing(() 2
)((2 3
{)) 	
if** 
(** 
!** 
this** 
.** 
disposed** 
)** 
{++ 
if,, 
(,, 
	disposing,, 
),, 
{-- 
database.. 
... 
Dispose.. $
(..$ %
)..% &
;..& '
}// 
this00 
.00 
disposed00 
=00 
true00  $
;00$ %
}11 
}22 	
public44 
void44 
Dispose44 
(44 
)44 
{55 	
Dispose66 
(66 
true66 
)66 
;66 
GC77 
.77 
SuppressFinalize77 
(77  
this77  $
)77$ %
;77% &
}88 	
}99 
}:: Ä
cD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\DAL\Interfaces\IUnitOfWork.cs
	namespace 	
CartingService
 
. 
DAL 
. 

Interfaces '
{ 
public 

	interface 
IUnitOfWork  
:! "
IDisposable# .
{ 
ILiteCollection 
< 
Cart 
> 
GetCartCollection /
(/ 0
)0 1
;1 2
ICartDAO		 
Cart		 
{		 
get		 
;		 
}		 
}

 
} ˚
`D:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\DAL\Interfaces\ICartDAO.cs
	namespace 	
CartingService
 
. 
DAL 
. 

Interfaces '
{ 
public 

	interface 
ICartDAO 
{ 
Task 
< 
Cart 
? 
> 
GetCartAsync  
(  !
string! '
key( +
)+ ,
;, -
Task 
AddCartAsync 
( 
Cart 
cart #
)# $
;$ %
Task		 
DeleteCartAsync		 
(		 
string		 #
key		$ '
)		' (
;		( )
Task

 
AddItemToCartAsync

 
(

  
string

  &
key

' *
,

* +
Item

, 0
item

1 5
)

5 6
;

6 7
Task 
DeleteCartItemAsync  
(  !
string! '
key( +
,+ ,
int- 0
itemId1 7
)7 8
;8 9
Task 
UpdateCartAsync 
( 
Cart !
cart" &
)& '
;' (
Task 
< 
IEnumerable 
< 
Cart 
> 
> -
!GetAllCartsContainingProductAsync  A
(A B
intB E
	productIdF O
)O P
;P Q
} 
} †;
TD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\DAL\CartDAO.cs
	namespace 	
CartingService
 
. 
DAL 
{ 
public 

class 
CartDAO 
: 
ICartDAO #
{		 
private

 
readonly

 
IUnitOfWork

 $
_context

% -
;

- .
private 
readonly 
ILiteCollection (
<( )
Cart) -
>- .
_cartSet/ 7
;7 8
public 
CartDAO 
( 
IUnitOfWork "
context# *
)* +
{ 	
_context 
= 
context 
; 
_cartSet 
= 
_context 
.  
GetCartCollection  1
(1 2
)2 3
;3 4
} 	
public 
async 
Task 
< 
Cart 
? 
>  
GetCartAsync! -
(- .
string. 4
key5 8
)8 9
{ 	
var 
cart 
= 
_cartSet 
.  
FindOne  '
(' (
c( )
=>* ,
c- .
.. /
Key/ 2
==3 5
key6 9
)9 :
;: ;
if 
( 
cart 
== 
null 
) 
{ 
return 
null 
; 
} 
return 
await 
Task 
. 

FromResult (
(( )
cart) -
)- .
;. /
} 	
public 
async 
Task 
AddCartAsync &
(& '
Cart' +
cart, 0
)0 1
{ 	
await 
Task 
. 

FromResult !
(! "
_cartSet" *
.* +
Insert+ 1
(1 2
cart2 6
)6 7
)7 8
;8 9
}   	
public"" 
async"" 
Task"" 
DeleteCartAsync"" )
("") *
string""* 0
key""1 4
)""4 5
{## 	
var$$ 
cart$$ 
=$$ 
_cartSet$$ 
.$$  
FindOne$$  '
($$' (
c$$( )
=>$$* ,
c$$- .
.$$. /
Key$$/ 2
==$$3 5
key$$6 9
)$$9 :
;$$: ;
if%% 
(%% 
cart%% 
==%% 
null%% 
)%% 
{&& 
throw'' 
new'' 
	Exception'' #
(''# $
$str''$ 4
)''4 5
;''5 6
}(( 
await)) 
Task)) 
.)) 

FromResult)) !
())! "
_cartSet))" *
.))* +
Delete))+ 1
())1 2
cart))2 6
.))6 7
Key))7 :
))): ;
))); <
;))< =
}** 	
public,, 
async,, 
Task,, 
AddItemToCartAsync,, ,
(,,, -
string,,- 3
key,,4 7
,,,7 8
Item,,9 =
item,,> B
),,B C
{-- 	
var.. 
cart.. 
=.. 
_cartSet.. 
...  
FindOne..  '
(..' (
c..( )
=>..* ,
c..- .
.... /
Key../ 2
==..3 5
key..6 9
)..9 :
;..: ;
if// 
(// 
cart// 
==// 
null// 
)// 
{00 
throw11 
new11 
	Exception11 #
(11# $
$str11$ 4
)114 5
;115 6
}22 
cart33 
.33 
Items33 
.33 
Add33 
(33 
item33 
)33  
;33  !
await44 
Task44 
.44 

FromResult44 !
(44! "
_cartSet44" *
.44* +
Update44+ 1
(441 2
cart442 6
)446 7
)447 8
;448 9
}55 	
public77 
async77 
Task77 
DeleteCartItemAsync77 -
(77- .
string77. 4
key775 8
,778 9
int77: =
itemId77> D
)77D E
{88 	
var99 
cart99 
=99 
_cartSet99 
.99  
FindOne99  '
(99' (
c99( )
=>99* ,
c99- .
.99. /
Key99/ 2
==993 5
key996 9
)999 :
;99: ;
if:: 
(:: 
cart:: 
==:: 
null:: 
):: 
{;; 
throw<< 
new<< 
	Exception<< #
(<<# $
$str<<$ 4
)<<4 5
;<<5 6
}== 
var>> 
item>> 
=>> 
cart>> 
.>> 
Items>> !
.>>! "
FirstOrDefault>>" 0
(>>0 1
i>>1 2
=>>>3 5
i>>6 7
.>>7 8
Id>>8 :
==>>; =
itemId>>> D
)>>D E
;>>E F
if?? 
(?? 
item?? 
==?? 
null?? 
)?? 
{@@ 
throwAA 
newAA 
	ExceptionAA #
(AA# $
$strAA$ @
)AA@ A
;AAA B
}BB 
cartCC 
.CC 
ItemsCC 
.CC 
RemoveCC 
(CC 
itemCC "
)CC" #
;CC# $
awaitDD 
TaskDD 
.DD 

FromResultDD !
(DD! "
_cartSetDD" *
.DD* +
UpdateDD+ 1
(DD1 2
cartDD2 6
)DD6 7
)DD7 8
;DD8 9
}EE 	
publicGG 
asyncGG 
TaskGG 
UpdateCartAsyncGG )
(GG) *
CartGG* .
cartGG/ 3
)GG3 4
{HH 	
awaitII 
TaskII 
.II 

FromResultII !
(II! "
_cartSetII" *
.II* +
UpdateII+ 1
(II1 2
cartII2 6
)II6 7
)II7 8
;II8 9
}JJ 	
publicLL 
asyncLL 
TaskLL 
<LL 
IEnumerableLL %
<LL% &
CartLL& *
>LL* +
>LL+ ,-
!GetAllCartsContainingProductAsyncLL- N
(LLN O
intLLO R
	productIdLLS \
)LL\ ]
{MM 	
returnNN 
awaitNN 
TaskNN 
.NN 
RunNN !
(NN! "
(NN" #
)NN# $
=>NN% '
{OO 
varPP 
cartsPP 
=PP 
_cartSetPP $
.PP$ %
FindAllPP% ,
(PP, -
)PP- .
;PP. /
returnQQ 
cartsQQ 
.QQ 
WhereQQ "
(QQ" #
cQQ# $
=>QQ% '
cQQ( )
.QQ) *
ItemsQQ* /
!=QQ0 2
nullQQ3 7
&&QQ8 :
cQQ; <
.QQ< =
ItemsQQ= B
.QQB C
AnyQQC F
(QQF G
iQQG H
=>QQI K
iQQL M
.QQM N
IdQQN P
==QQQ S
	productIdQQT ]
)QQ] ^
)QQ^ _
.QQ_ `
ToListQQ` f
(QQf g
)QQg h
;QQh i
}RR 
)RR 
;RR 
}SS 	
}TT 
}UU Â
eD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Controllers\CartV2Controller.cs
	namespace 	
CartingService
 
. 
Controllers $
.$ %
V2% '
{ 
[ 

ApiVersion 
( 
$str 
) 
] 
[		 
ApiExplorerSettings		 
(		 
	GroupName		 "
=		# $
$str		% )
)		) *
]		* +
[

 
	Authorize

 
(

 
Roles

 
=

 
$str

 .
)

. /
]

/ 0
[ 
ApiController 
] 
[ 
Route 

(
 
$str +
)+ ,
], -
public 

class 
CartV2Controller !
:" #
ControllerBase$ 2
{ 
private 
readonly 
ILogger  
<  !
CartV2Controller! 1
>1 2
_logger3 :
;: ;
private 
readonly 
ICartBL  
_cartBL! (
;( )
public 
CartV2Controller 
(  
ILogger  '
<' (
CartV2Controller( 8
>8 9
logger: @
,@ A
ICartBLB I
cartBLJ P
)P Q
{ 	
_logger 
= 
logger 
; 
_cartBL 
= 
cartBL 
; 
} 	
[ 	
HttpGet	 
( 
$str 
) 
]  
[ 	
MapToApiVersion	 
( 
$str 
) 
]  
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
ItemDto3 :
>: ;
>; <
>< =
GetCartItems> J
(J K
stringK Q
keyR U
)U V
{ 	
var 
cart 
= 
await 
_cartBL $
.$ %
GetCartAsync% 1
(1 2
key2 5
)5 6
;6 7
if 
( 
cart 
== 
null 
) 
{ 
return 
NotFound 
(  
)  !
;! "
}   
return!! 
Ok!! 
(!! 
cart!! 
.!! 
Items!!  
)!!  !
;!!! "
}"" 	
[$$ 	
HttpPost$$	 
($$ 
$str$$ 
)$$  
]$$  !
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' (
AddItemToCart%%) 6
(%%6 7
string%%7 =
key%%> A
,%%A B
[%%C D
FromBody%%D L
]%%L M
ItemDto%%N U
itemDto%%V ]
)%%] ^
{&& 	
await'' 
_cartBL'' 
.'' 
AddItemToCartAsync'' ,
('', -
key''- 0
,''0 1
itemDto''2 9
)''9 :
;'': ;
return(( 
Ok(( 
((( 
)(( 
;(( 
})) 	
[++ 	

HttpDelete++	 
(++ 
$str++ *
)++* +
]+++ ,
public,, 
async,, 
Task,, 
<,, 
IActionResult,, '
>,,' (
DeleteItemFromCart,,) ;
(,,; <
string,,< B
key,,C F
,,,F G
int,,H K
itemId,,L R
),,R S
{-- 	
await.. 
_cartBL.. 
... #
DeleteItemFromCartAsync.. 1
(..1 2
key..2 5
,..5 6
itemId..7 =
)..= >
;..> ?
return// 
Ok// 
(// 
)// 
;// 
}00 	
}11 
}22 á
eD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\Controllers\CartV1Controller.cs
	namespace 	
CartingService
 
. 
Controllers $
.$ %
V1% '
{ 
[ 

ApiVersion 
( 
$str 
) 
] 
[		 
ApiExplorerSettings		 
(		 
	GroupName		 "
=		# $
$str		% )
)		) *
]		* +
[

 
	Authorize

 
(

 
Roles

 
=

 
$str

 .
)

. /
]

/ 0
[ 
ApiController 
] 
[ 
Route 

(
 
$str +
)+ ,
], -
public 

class 
CartV1Controller !
:" #
ControllerBase$ 2
{ 
private 
readonly 
ILogger  
<  !
CartV1Controller! 1
>1 2
_logger3 :
;: ;
private 
readonly 
ICartBL  
_cartBL! (
;( )
public 
CartV1Controller 
(  
ILogger  '
<' (
CartV1Controller( 8
>8 9
logger: @
,@ A
ICartBLB I
cartBLJ P
)P Q
{ 	
_logger 
= 
logger 
; 
_cartBL 
= 
cartBL 
; 
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
[ 	
MapToApiVersion	 
( 
$str 
) 
]  
public 
async 
Task 
< 
ActionResult &
<& '
CartDto' .
>. /
>/ 0
GetCart1 8
(8 9
string9 ?
key@ C
)C D
{ 	
var 
cart 
= 
await 
_cartBL $
.$ %
GetCartAsync% 1
(1 2
key2 5
)5 6
;6 7
if 
( 
cart 
== 
null 
) 
{ 
return 
NotFound 
(  
)  !
;! "
}   
return!! 
Ok!! 
(!! 
cart!! 
)!! 
;!! 
}"" 	
[$$ 	
HttpPost$$	 
($$ 
$str$$ 
)$$  
]$$  !
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' (
AddItemToCart%%) 6
(%%6 7
string%%7 =
key%%> A
,%%A B
[%%C D
FromBody%%D L
]%%L M
ItemDto%%N U
itemDto%%V ]
)%%] ^
{&& 	
await'' 
_cartBL'' 
.'' 
AddItemToCartAsync'' ,
('', -
key''- 0
,''0 1
itemDto''2 9
)''9 :
;'': ;
return(( 
Ok(( 
((( 
)(( 
;(( 
})) 	
[++ 	

HttpDelete++	 
(++ 
$str++ *
)++* +
]+++ ,
public,, 
async,, 
Task,, 
<,, 
IActionResult,, '
>,,' (
DeleteItemFromCart,,) ;
(,,; <
string,,< B
key,,C F
,,,F G
int,,H K
itemId,,L R
),,R S
{-- 	
await.. 
_cartBL.. 
... #
DeleteItemFromCartAsync.. 1
(..1 2
key..2 5
,..5 6
itemId..7 =
)..= >
;..> ?
return// 
Ok// 
(// 
)// 
;// 
}00 	
}11 
}22 è
_D:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\BLL\Interfaces\ICartBL.cs
	namespace 	
CartingService
 
. 
BLL 
. 

Interfaces '
{ 
public 

	interface 
ICartBL 
{ 
Task 
< 
CartDto 
? 
> 
GetCartAsync #
(# $
string$ *
key+ .
). /
;/ 0
Task		 
AddCartAsync		 
(		 
CartDto		 !
cartDto		" )
)		) *
;		* +
Task

 
DeleteCartAsync

 
(

 
string

 #
key

$ '
)

' (
;

( )
Task 
AddItemToCartAsync 
(  
string  &
key' *
,* +
ItemDto, 3
itemDto4 ;
); <
;< =
Task #
DeleteItemFromCartAsync $
($ %
string% +
key, /
,/ 0
int1 4
itemId5 ;
); <
;< =
Task %
UpdateItemInAllCartsAsync &
(& '
int' *
	productId+ 4
,4 5
string6 <
newName= D
,D E
decimalF M
newPriceN V
)V W
;W X
} 
} ¬7
SD:\EBSCO\GitHub\DotNET_Mentoring_Program_Advanced_2025\CartingService\BLL\CartBL.cs
	namespace 	
CartingService
 
. 
BLL 
{		 
public

 

class

 
CartBL

 
:

 
ICartBL

 !
{ 
private 
readonly 
IUnitOfWork $
_uow% )
;) *
private 
readonly 
IMapper  
_mapper! (
;( )
public 
CartBL 
( 
IUnitOfWork !
uow" %
,% &
IMapper' .
mapper/ 5
)5 6
{ 	
_uow 
= 
uow 
; 
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
CartDto !
?! "
>" #
GetCartAsync$ 0
(0 1
string1 7
key8 ;
); <
{ 	
var 
cart 
= 
await 
_uow !
.! "
Cart" &
.& '
GetCartAsync' 3
(3 4
key4 7
)7 8
;8 9
return 
_mapper 
. 
Map 
< 
CartDto &
?& '
>' (
(( )
cart) -
)- .
;. /
} 	
public 
async 
Task 
AddCartAsync &
(& '
CartDto' .
cartDto/ 6
)6 7
{ 	
var 
existingCart 
= 
await $
_uow% )
.) *
Cart* .
.. /
GetCartAsync/ ;
(; <
cartDto< C
.C D
KeyD G
)G H
;H I
if 
( 
existingCart 
!= 
null  $
)$ %
{ 
throw   
new   %
InvalidOperationException   3
(  3 4
$str  4 Z
)  Z [
;  [ \
}!! 
var## 
cart## 
=## 
_mapper## 
.## 
Map## "
<##" #
Cart### '
>##' (
(##( )
cartDto##) 0
)##0 1
;##1 2
await%% 
_uow%% 
.%% 
Cart%% 
.%% 
AddCartAsync%% (
(%%( )
cart%%) -
)%%- .
;%%. /
}&& 	
public(( 
async(( 
Task(( 
DeleteCartAsync(( )
((() *
string((* 0
key((1 4
)((4 5
{)) 	
var** 
cart** 
=** 
await** 
_uow** !
.**! "
Cart**" &
.**& '
GetCartAsync**' 3
(**3 4
key**4 7
)**7 8
;**8 9
if++ 
(++ 
cart++ 
==++ 
null++ 
)++ 
{,, 
throw-- 
new-- %
InvalidOperationException-- 3
(--3 4
$str--4 E
)--E F
;--F G
}.. 
await// 
_uow// 
.// 
Cart// 
.// 
DeleteCartAsync// +
(//+ ,
key//, /
)/// 0
;//0 1
}00 	
public22 
async22 
Task22 
AddItemToCartAsync22 ,
(22, -
string22- 3
key224 7
,227 8
ItemDto229 @
itemDto22A H
)22H I
{33 	
var44 
cart44 
=44 
await44 
_uow44 !
.44! "
Cart44" &
.44& '
GetCartAsync44' 3
(443 4
key444 7
)447 8
??449 ;
new44< ?
Cart44@ D
{44E F
Key44G J
=44K L
key44M P
,44P Q
Items44R W
=44X Y
new44Z ]
List44^ b
<44b c
Item44c g
>44g h
(44h i
)44i j
}44k l
;44l m
var55 
item55 
=55 
_mapper55 
.55 
Map55 "
<55" #
Item55# '
>55' (
(55( )
itemDto55) 0
)550 1
;551 2
cart66 
.66 
Items66 
.66 
Add66 
(66 
item66 
)66  
;66  !
if77 
(77 
cart77 
.77 
Items77 
.77 
Count77  
==77! #
$num77$ %
)77% &
{88 
await99 
_uow99 
.99 
Cart99 
.99  
AddCartAsync99  ,
(99, -
cart99- 1
)991 2
;992 3
}:: 
else;; 
{<< 
await== 
_uow== 
.== 
Cart== 
.==  
UpdateCartAsync==  /
(==/ 0
cart==0 4
)==4 5
;==5 6
}>> 
}?? 	
publicAA 
asyncAA 
TaskAA #
DeleteItemFromCartAsyncAA 1
(AA1 2
stringAA2 8
keyAA9 <
,AA< =
intAA> A
itemIdAAB H
)AAH I
{BB 	
awaitCC 
_uowCC 
.CC 
CartCC 
.CC 
DeleteCartItemAsyncCC /
(CC/ 0
keyCC0 3
,CC3 4
itemIdCC5 ;
)CC; <
;CC< =
}DD 	
publicFF 
asyncFF 
TaskFF %
UpdateItemInAllCartsAsyncFF 3
(FF3 4
intFF4 7
	productIdFF8 A
,FFA B
stringFFC I
newNameFFJ Q
,FFQ R
decimalFFS Z
newPriceFF[ c
)FFc d
{GG 	
varHH 
cartsHH 
=HH 
awaitHH 
_uowHH "
.HH" #
CartHH# '
.HH' (-
!GetAllCartsContainingProductAsyncHH( I
(HHI J
	productIdHHJ S
)HHS T
;HHT U
foreachJJ 
(JJ 
varJJ 
cartJJ 
inJJ  
cartsJJ! &
)JJ& '
{KK 
foreachLL 
(LL 
varLL 
itemLL !
inLL" $
cartLL% )
.LL) *
ItemsLL* /
)LL/ 0
{MM 
ifNN 
(NN 
itemNN 
.NN 
IdNN 
==NN  "
	productIdNN# ,
)NN, -
{OO 
itemPP 
.PP 
NamePP !
=PP" #
newNamePP$ +
;PP+ ,
itemQQ 
.QQ 
PriceQQ "
=QQ# $
newPriceQQ% -
;QQ- .
}RR 
}SS 
awaitUU 
_uowUU 
.UU 
CartUU 
.UU  
UpdateCartAsyncUU  /
(UU/ 0
cartUU0 4
)UU4 5
;UU5 6
}VV 
}WW 	
}XX 
}YY 